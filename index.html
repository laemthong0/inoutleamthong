<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏´‡∏•‡∏°‡∏ó‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡πÄ‡∏Å‡∏©‡∏ï‡∏£</title>
  
  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
  
  <!-- Fonts & Style -->
  <style>
    @font-face { font-family: 'Digital dream Fat'; src: url('https://semicon.github.io/fonts/DigitaldreamFat.woff2') format('woff2'); }
    :root { --primary-color: #28a745; --secondary-color: #f1c40f; --dark-color: #2c3e50; --border-radius: 8px; --box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Kanit', sans-serif; }
    body { font-size: 1.05rem; min-height: 100vh; display: flex; align-items: center; justify-content: center; background-color: #e8f5e9; padding: 15px; }
    .wrapper { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); border-top: 5px solid var(--primary-color); }
    .site-logo { width: auto; height: 80px; margin-bottom: 15px; }
    .company-name { font-weight: 700; font-size: 1.8rem; margin: 0 0 15px; color: var(--dark-color); }
    .msgBg { background: #f8f9fa; color: var(--dark-color); border: 1px solid #dee2e6; padding: 12px; border-radius: var(--border-radius); font-weight: 500; }
    .clock-container { background: #333; padding: 15px; border-radius: var(--border-radius); margin-bottom: 20px; }
    .clock { font-family: 'Digital dream Fat', monospace; font-size: 2.5rem; color: #0f0; text-shadow: 0 0 10px #0f0; letter-spacing: 3px; text-align: center; }
    .btn-action { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
    .btn { height: 50px; border-radius: var(--border-radius); font-weight: 500; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; border: none; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .btn i { margin-right: 8px; }
    .btn-clockin { background-color: var(--primary-color); color: white; }
    .btn-clockout { background-color: var(--secondary-color); color: #212529; }
    .alert { min-height: 50px; display: flex; align-items: center; justify-content: center; text-align: center; }
  </style>
</head>

<body>
  <div class="wrapper">
    <div class="text-center">
      <img src="https://img5.pic.in.th/file/secure-sv1/7088b986100a839eee3df494134be747.png" alt="‡πÅ‡∏´‡∏•‡∏°‡∏ó‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡πÄ‡∏Å‡∏©‡∏ï‡∏£" class="site-logo">
      <h1 class="company-name">‡πÅ‡∏´‡∏•‡∏°‡∏ó‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡πÄ‡∏Å‡∏©‡∏ï‡∏£</h1>
    </div>
    <div class="clock-container">
      <div id="MyClockDisplay" class="clock">00:00:00</div>
    </div>
    <form id="myForm" onsubmit="return false;">
      <div class="form-group mb-3">
        <label for="employee" class="form-label">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
        <select class="form-control" id="employee" style="width: 100%;"></select>
      </div>
      <div class="btn-action">
        <button type="button" class="btn btn-clockin" id="clockInBtn"><i class="fas fa-sign-in-alt"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô</button>
        <button type="button" class="btn btn-clockout" id="clockOutBtn"><i class="fas fa-sign-out-alt"></i>‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô</button>
      </div>
      <div class="form-group">
        <div class="alert msgBg" role="alert" id="message"></div>
      </div>
    </form>
  </div>

  <!-- JavaScript Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.1/purify.min.js"></script>

  <script>
    const App = (() => {
      const config = {
        webAppUrl: 'YOUR_WEB_APP_URL_HERE', // <-- !!! ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà !!!
        cacheDuration: 300000,
      };

      const state = {
        employeeCache: null,
        lastFetch: 0,
        isFetching: false,
        isClocking: false,
      };

      const elements = {
        employeeSelect: $('#employee'),
        clockInBtn: $('#clockInBtn'),
        clockOutBtn: $('#clockOutBtn'),
        message: $('#message'),
        clockDisplay: $('#MyClockDisplay'),
      };

      async function callApi(action, params = {}) {
        if (!config.webAppUrl || config.webAppUrl === 'https://www.google.com/url?sa=E&q=https%3A%2F%2Fscript.google.com%2Fmacros%2Fs%2FAKfycbzQETxqoLA6CfSXU0AvEnUjGdqZP2Huq6ueuYiJoXcnsbFCvLd2MRtbrEEJOZMdIFNN%2Fexec') {
          throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Web App URL ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå HTML ‡∏Å‡πà‡∏≠‡∏ô");
        }
        try {
          const response = await fetch(config.webAppUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify({ action, params }),
            redirect: 'follow'
          });
          if (!response.ok) throw new Error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (Status: ${response.status})`);
          const result = await response.json();
          if (result.status === 'error') throw new Error(result.message);
          return result.data;
        } catch (error) {
          console.error("API Call Error:", error);
          if (error.message.includes('Failed to fetch')) {
            throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
          }
          throw error;
        }
      }
      
      // ======================================================================
      // START: ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á Dropdown ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
      // ======================================================================
      function updateEmployeeList(employees) {
        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const savedEmployee = localStorage.getItem('selectedEmployee');

        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Dropdown ‡πÄ‡∏î‡∏¥‡∏°
        elements.employeeSelect.empty();
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Placeholder ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        elements.employeeSelect.append(new Option('‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...', '', true, true)).prop('disabled', true);

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÑ‡∏î‡πâ
        if (Array.isArray(employees) && employees.length > 0) {
            employees.forEach(item => {
                const name = item[0] ? item[0].trim() : '';
                if (name) {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Option object ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    const option = new Option(name, name, false, name === savedEmployee);
                    elements.employeeSelect.append(option);
                }
            });
        }
        
        // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ Select2 ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Dropdown
        elements.employeeSelect.prop('disabled', false).trigger('change');
      }
      // ======================================================================
      // END: ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      // ======================================================================

      async function getEmployees(forceRefresh = false) {
        const now = Date.now();
        if (!forceRefresh && state.employeeCache && (now - state.lastFetch < config.cacheDuration)) {
          updateEmployeeList(state.employeeCache);
          return;
        }
        if (state.isFetching) return;

        state.isFetching = true;
        ui.showLoading(true);

        try {
          const data = await callApi('getEmployees');
          const safeData = Array.isArray(data) ? data : [];
          state.lastFetch = now;
          state.employeeCache = safeData;
          updateEmployeeList(safeData); // <--- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
        } catch (error) {
          ui.showNotification(`‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${error.message}`);
        } finally {
          state.isFetching = false;
          ui.showLoading(false);
        }
      }

      async function handleClocking(action, actionText) {
        if (state.isClocking) return;
        const employee = DOMPurify.sanitize(elements.employeeSelect.val());
        if (!employee) {
          ui.showNotification('üö´üßë ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô');
          return;
        }
        state.isClocking = true;
        ui.toggleButtons(false);
        try {
          ui.showLoading('<i class="fas fa-map-marker-alt"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...');
          const position = await getGpsLocation();
          const gps = [position.coords.latitude, position.coords.longitude];
          ui.showLoading('<i class="fas fa-save"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
          const result = await callApi(action, { employee, gps });
          result.forEach(item => {
            if (item[0] === 'SUCCESS') {
              ui.showPopup(employee, item[1], actionText, item[3]);
            } else {
              ui.showNotification(`‚ö†Ô∏è ${item[2]} ${item[0]}`);
            }
          });
        } catch (error) {
          if (error.code >= 1 && error.code <= 5) {
            handleGpsError(error);
          } else {
            ui.showNotification(`‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
          }
        } finally {
          state.isClocking = false;
          ui.toggleButtons(true);
          ui.showLoading(false);
        }
      }

      function getGpsLocation() {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        const ACCEPTABLE_ACCURACY = 100;
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) return reject({ code: 4, message: "‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Geolocation" });
          navigator.geolocation.getCurrentPosition(
            (position) => {
              if (position.coords.accuracy > ACCEPTABLE_ACCURACY) return reject({ code: 5, message: `‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (${Math.round(position.coords.accuracy)} ‡∏°.) ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠` });
              resolve(position);
            },
            (error) => reject(error),
            { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
          );
        });
      }

      function handleGpsError(err) {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        let title, htmlContent;
        const isLineBrowser = navigator.userAgent.toLowerCase().includes("line");
        switch (err.code) {
          case 1: title = "‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"; htmlContent = isLineBrowser ? `<div style="text-align: left; padding: 10px;"><p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î‡∏Å‡∏±‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (GPS) ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á LINE</p><p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong></p><ol style="padding-left: 20px;"><li>‡πÅ‡∏ï‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô <strong>"‡∏à‡∏∏‡∏î‡∏™‡∏≤‡∏°‡∏à‡∏∏‡∏î" (‚ãÆ)</strong> ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á</li><li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå"</strong></li><li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"</strong> > ‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <strong>"‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå"</strong></li><li>‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß<strong>‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà</strong>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li></ol></div>` : `<div style="text-align: left; padding: 10px;"><p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏õ‡∏¥‡∏î‡∏Å‡∏±‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (GPS)</p><p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (Chrome):</strong></p><ol style="padding-left: 20px;"><li>‡πÅ‡∏ï‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô üîí (‡πÅ‡∏°‡πà‡∏Å‡∏∏‡∏ç‡πÅ‡∏à) ‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</li><li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå"</strong></li><li>‡∏°‡∏≠‡∏á‡∏´‡∏≤ <strong>"‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"</strong> ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô <strong>"‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï"</strong></li><li>‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà</li></ol></div>`; break;
          case 2: title = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ"; htmlContent = "‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì GPS ‡∏≠‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏•‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á"; break;
          case 3: title = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"; htmlContent = "‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì GPS"; break;
          case 5: title = "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏û‡∏≠"; htmlContent = `‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (${err.message})`; break;
          default: title = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"; htmlContent = `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${err.message})`;
        }
        Swal.fire({ icon: 'warning', title: `‚ö†Ô∏è ${title}`, html: htmlContent, confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß', confirmButtonColor: '#d33' });
      }

      const ui = {
        // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        toggleButtons: (enabled) => { elements.clockInBtn.prop('disabled', !enabled); elements.clockOutBtn.prop('disabled', !enabled); },
        showLoading: (isLoading) => { if (isLoading) { const message = typeof isLoading === 'string' ? isLoading : '<div class="spinner-border spinner-border-sm" role="status"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...'; elements.message.html(message).removeClass('msgBg').addClass('alert-info'); } else { elements.message.html('‚òÄÔ∏è ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç').removeClass('alert-info').addClass('msgBg'); } },
        showNotification: (message) => { elements.message.html(message).removeClass('msgBg').addClass('alert-info'); },
        showPopup: (employee, time, status, location) => { Swal.fire({ icon: 'success', title: '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', html: `<div style="text-align: left; padding: 0 1rem;"><p><strong>üë§ ‡∏ä‡∏∑‡πà‡∏≠:</strong> ${DOMPurify.sanitize(employee)}</p><p><strong>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${time.replace(/<br>/g, ' ')}</p><p><strong>üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${DOMPurify.sanitize(status)}</p><p><strong>üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${DOMPurify.sanitize(location)}</p></div>`, confirmButtonText: '‡∏õ‡∏¥‡∏î', confirmButtonColor: '#28a745' }); }
      };

      function init() {
        elements.employeeSelect.select2({
          theme: 'bootstrap-5',
          placeholder: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô',
        }).on('change', function() {
          localStorage.setItem('selectedEmployee', $(this).val());
        });

        setInterval(() => {
          const now = new Date();
          const timeString = [now.getHours(), now.getMinutes(), now.getSeconds()].map(num => String(num).padStart(2, '0')).join(':');
          elements.clockDisplay.text(timeString);
        }, 1000);
        
        elements.clockInBtn.on('click', () => handleClocking('clockIn', '‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô'));
        elements.clockOutBtn.on('click', () => handleClocking('clockOut', '‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô'));
        
        ui.showLoading(false);
        getEmployees();
      }

      return { init };
    })();

    $(document).ready(App.init);
  </script>
</body>
</html>
